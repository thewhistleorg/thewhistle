<form method="post" enctype="multipart/form-data" class="pure-form">
    {{> back}}{{> step}}
    {{> flash}}

    <div  class="margin-top-3">
        <script>
            'use strict';
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelector('input[type=file]').onchange = cloneFileInput; // change handler for initial file input
                function cloneFileInput(event) {
                    const fileInputs = document.querySelectorAll('input[type=file]');
                    const el = event.target;
                    // if we already have a 'no file chosen' input, don't clone another
                    for (const i of fileInputs) if (i.files.length == 0) return;
                    // if same file has already been chosen, clear the filename & don't clone
                    const inputsWithThisName = [...fileInputs].filter(f => f.files[0].name == el.files[0].name)
                    if (inputsWithThisName.length > 1) { el.value = ''; return; }
                    const copy = el.cloneNode(true);
                    copy.onchange = cloneFileInput;
                    copy.value = '';
                    copy.id = 'document' + (fileInputs.length);
                    el.insertAdjacentElement('afterend', copy)
                }
            });
        </script>

        <h1>This is an anonymous service. Any information you provide will be seen only by staff and
            volunteers of Global Rights Nigeria.</h1>

        <p class="hint-text">{{q.6a}}</p>

        <ul id="question-description" class="question">
            {{#checked description}}
            <li>
                <label for="description">Description:</label>
                <textarea name="description" id="description" rows="4" autofocus class="pure-input-1">{{description}}</textarea>
            </li>
            <li>
                <label for="document0">
                    <strong>Please upload any evidence that could help.</strong>
                    This can be photos, videos or any other documents.
                    {{#if files}}
                    <span class="note">note: please reselect
                        {{#each files}}{{this.name}}{{#unless @last}}, {{/unless}}{{/each}}
                        if you wish to submit them</span>
                    {{/if}}
                </label>
                <input type="file" name="documents" id="document0" value="0" class="upload-file">
            </li>
            <li>
                <input type="radio" name="description" id="description-skip" value="skip">
                <label for="description-skip" class="pure-radio greyed-out-unless-checked">Skip</label>
            </li>
            {{/checked}}
        </ul>

        {{> continue}}
        {{> notworking}}
    </div>
</form>
