<form method="post" enctype="multipart/form-data" class="pure-form">
    {{> back}}{{> step}}
    <ul class="validation-errors">{{#@koa.flash.validation}}<li>{{this}}</li>{{/@koa.flash.validation}}</ul>

    <div  class="margin-top-3">
        <script>
            'use strict';
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelector('input[type=file]').onchange = cloneFileInput; // change handler for initial file input
                function cloneFileInput(event) {
                    const fileInputs = document.querySelectorAll('input[type=file]');
                    const el = event.target;
                    // if we already have a 'no file chosen' input, don't clone another
                    for (const i of fileInputs) if (i.files.length == 0) return;
                    // if same file has already been chosen, clear the filename & don't clone
                    const inputsWithThisName = [...fileInputs].filter(f => f.files[0].name == el.files[0].name)
                    if (inputsWithThisName.length > 1) { el.value = ''; return; }
                    const copy = el.cloneNode(true);
                    copy.onchange = cloneFileInput;
                    copy.value = '';
                    copy.id = 'document' + (fileInputs.length);
                    el.insertAdjacentElement('afterend', copy)
                }
            });
        </script>

        <h1>This is an anonymous service. Any information you provide will be seen only by staff and
            volunteers of Global Rights Nigeria.</h1>

        <p class="hint-text">{{q.6a}}</p>

        <ul>
          {{#checked description}}
            <li>
                <label for="description">Description:</label>
                <textarea class="pure-input-1" name="description" id="description" rows="4" autofocus>{{description}}</textarea>
            </li>
            <li>
                <label for="document0">
                    <strong>Please upload any evidence that could help.</strong>
                    This can be photos, videos or any other documents.
                    {{#if files}}
                    <span class="note">note: please reselect
                        {{#each files}}{{this.name}}{{#unless @last}}, {{/unless}}{{/each}}
                        if you wish to submit them</span>
                    {{/if}}
                </label>
                <input type="file" name="documents" value="0" id="document0" class="upload-file">
            </li>
            <li>
                <input type="radio" name="description" id="description-skip" value="skipped">
                <label for="description-skip" class="pure-radio greyed-out-unless-checked">Skip</label>
            </li>
            {{/checked}}
        </ul>

        <h1>{{q.6b}}</h1>
        <h3>Gender</h3>
        <ul>
            {{#checked survivor-gender}}
            <li>
                <input type="radio" name="survivor-gender" id="survivor-gender-m" value="m"> <label for="survivor-gender-m">Male</label>
            </li>
            <li>
                <input type="radio" name="survivor-gender" id="survivor-gender-f" value="f"> <label for="survivor-gender-f">Female</label>
            </li>
            <li>
                <input type="radio" name="survivor-gender" id="survivor-gender-skip" value="skip"> <label for="survivor-gender-skip">Skip</label>
            </li>
            {{/checked}}
        </ul>

        <h3>Age</h3>
        <ul>
          {{#checked survivor-age}}
            <li>
                <label for="survivor-age"></label>
                <select name="survivor-age" id="survivor-age" class="w16">
                    {{#selected survivor-age}}
                    <option></option>
                    <option>0–17</option>
                    <option>18–22</option>
                    <option>23–27</option>
                    <option>28–32</option>
                    <option>33+</option>
                    {{/selected}}
                </select>
            </li>
            <li>
                <input type="radio" name="survivor-age" id="survivor-age-skip" value="skipped">
                <label for="survivor-age-skip" class="pure-radio greyed-out-unless-checked">Skip</label>
            </li>
            {{/checked}}
        </ul>

        {{> continue}}
    </div>
</form>
