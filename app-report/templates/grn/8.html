<!doctype html>
<html lang="en">
<head>
    <title>The Whistle / Global Rights Nigeria Incident Report | Photographs</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https//unpkg.com/purecss@1.0.0/build/pure-min.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/grn.css">
    <style>
        p.note { clear: both; color: #999999; margin-top: 4em; }
    </style>
    <script defer src="/js/report.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            'use strict';

            document.querySelector('input[type=file]').onchange = cloneFileInput; // change handler for initial file input

            function cloneFileInput(event) {
                const fileInputs = document.querySelectorAll('input[type=file]');
                const el = event.target;
                // if we already have a 'no file chosen' input, don't clone another
                for (var i of fileInputs) if (i.files.length==0) return;
                // if same file has already been chosen, clear the filename & don't clone
                const inputsWithThisName = [...fileInputs].filter(f => f.files[0].name==el.files[0].name)
                if (inputsWithThisName.length > 1) { el.value = ''; return; }
                const copy = el.cloneNode(true);
                copy.onchange = cloneFileInput;
                copy.value = '';
                copy.id = 'document'+(fileInputs.length);
                el.insertAdjacentElement('afterend', copy)
            }
        });
    </script>
</head>
<body>

<header>
    <nav class="pure-menu pure-menu-horizontal">
        <ul class="pure-menu-list">
            <li class="pure-menu-item"><img src="../img/logo-32.png"></li>
            <li class="pure-menu-item">The Whistle | Global Rights Nigeria Incident Report</li>
        </ul>
    </nav>
</header>

<main>

<table class="progress"><tr><td>p{{p}}/{{n}}</td></tr></table>

<h1>Photographs</h1>

<ul class="validation-errors">{{#@koa.flash.validation}}<li>{{this}}</li>{{/@koa.flash.validation}}</ul>

<form method="post" enctype="multipart/form-data" class="pure-form pure-form-aligned">
    <ul>
        <li>
            <label for="document0">Upload photos / videos / documents documenting the incident
                {{#if files}}<span class="note">note: please reselect {{#each files}}{{this.name}}{{#unless @last}}, {{/unless}}{{/each}} if you wish to submit them</span>{{/if}}</label>
            <input type="file" name="documents" value="0" id="document0">
        </li>
        <li class="nav">
            <button type="submit" name="nav-prev" value="prev" accesskey="p" class="nav prev">⇐ <u>P</u>revious</button>
            <button type="submit" name="nav-next" value="next" accesskey="n" class="nav next"><u>N</u>ext ⇒</button>
        </li>
    </ul>
</form>
<p class="note">Note: uploaded files should be held in sub-folder identified by chosen id name, which could be difficult to generalise.</p>

</main>

</body>
</html>
