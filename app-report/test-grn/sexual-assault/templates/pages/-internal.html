<form method="post" enctype="multipart/form-data" class="pure-form pure-form-aligned">
    <ul class="validation-errors">{{#@koa.flash.validation}}<li>{{this}}</li>{{/@koa.flash.validation}}</ul>

    <div >
        <h1>Are you reporting on behalf of yourself or someone else?</h1>
        <ul>
            <li>
                <input type="radio" name="on-behalf-of" id="myself" value="myself">
                <label for="myself">Me</label>
            </li>
            <li>
                <input type="radio" name="on-behalf-of" id="someone-else" value="someone-else">
                <label for="someone-else">Someone else</label>
            </li>
        </ul>
    </div>

    <hr>

    <div >

        <p class="special-intro">We understand that this can be difficult.<br>
            So please take your time and tell us what happened.</p>

        <h1>To begin with, when did it happen?</h1>

        <ul>
            {{#checked when}}
            <li>
                <input type="radio" name="when" id="when-date" value="date">
                <label for="when-date" class="pure-radio">On</label>
                <table class="inline">
                    <tr class="field-label">
                        <td>DD</td>
                        <td>MMM</td>
                        <td>YYYY</td>
                    </tr>
                    <tr>
                        <td><input type="number" name="date.day" id="date.day" value="{{date.day}}"
                                   class="w4" min="1" max="31"></td>
                        <td><input type="text" name="date.month" id="date.month" value="{{date.month}}" list="months"
                                   class="w5" maxlength="3"></td>
                        <td><input type="number" name="date.year" id="date.year" value="{{date.year}}"
                                   class="w5" min="{{lastyear}}" max="{{thisyear}}"></td>
                    </tr>
                </table>
                <datalist id="months">
                    <option value="Jan"><option value="Feb"><option value="Mar">
                    <option value="Apr"><option value="May"><option value="Jun">
                    <option value="Jul"><option value="Aug"><option value="Sep">
                    <option value="Oct"><option value="Nov"><option value="Dec">
                </datalist>
                at
                <table class="inline">
                    <tr class="field-label">
                        <td>HH</td>
                        <td>MM</td>
                    </tr>
                    <tr>
                        <td><input type="number" name="date.hour" id="date.hour" value="{{date.hour}}"
                                   class="w4" min="0" max="23" title="24h"></td>
                        <td><input type="number" name="date.minute" id="date.minute" value="{{date.minute}}"
                                   class="w4" min="0" max="59"></td>
                    </tr>
                </table>
            </li>
            <li>
                <input type="radio" name="when" id="when-within" value="within">
                <label for="when-within">It was within</label>
                <select name="within-options" id="within-options">
                    <option value="">&nbsp;</option>
                    <option value="within last month">Last month</option>
                    <option value="within last 6 months">Last six months</option>
                    <option value="within last year">Last year</option>
                    <option value="more than a year ago">More than a year ago</option>
                </select>
            </li>
            <li>
                <input type="radio" name="when" id="when-dont-remember" value="dont-remember">
                <label for="when-dont-remember">I don't exactly remember</label>
            </li>
            <li>
                <input type="radio" name="when" id="when-dont-know" value="dont-know">
                <label for="when-dont-know">I don't know when it happened</label>
            </li>
            {{/checked}}
        </ul>
        <h1>Is it still happening?</h1>
        <ul>
            {{#checked still-happening}}
            <li>
                <input type="radio" name="still-happening" id="still-y" value="y">
                <label for="still-y">Yes</label>
                <input type="radio" name="still-happening" id="still-n" value="n" class="radio-margin">
                <label for="still-n">No</label>
            </li>
            {{/checked}}
        </ul>
    </div>

    <hr>

    <div >
        <script>
            'use strict';
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelector('input[type=file]').onchange = cloneFileInput; // change handler for initial file input
                function cloneFileInput(event) {
                    const fileInputs = document.querySelectorAll('input[type=file]');
                    const el = event.target;
                    // if we already have a 'no file chosen' input, don't clone another
                    for (var i of fileInputs) if (i.files.length == 0) return;
                    // if same file has already been chosen, clear the filename & don't clone
                    const inputsWithThisName = [...fileInputs].filter(f => f.files[0].name == el.files[0].name)
                    if (inputsWithThisName.length > 1) { el.value = ''; return; }
                    const copy = el.cloneNode(true);
                    copy.onchange = cloneFileInput;
                    copy.value = '';
                    copy.id = 'document' + (fileInputs.length);
                    el.insertAdjacentElement('afterend', copy)
                }
            });
        </script>

        <h1>Describe what happened</h1>
        <p class="hint-text">You may wish to include what led up to the event, if there were any
            witnesses, and if anyone was told about it afterwards.</p>

        <ul>
            <li>
                <label for="description">
                    Description:
                </label>
                <textarea class="pure-input-1" name="description" id="description" rows="4" required>{{description}}</textarea>
            </li>
            <li>
                <label for="document0">
                    <strong>Please upload any evidence that could help.</strong>
                    This can be photos, videos or any other documents.
                    {{#if files}}
                    <span class="note">note: please reselect
                        {{#each files}}{{this.name}}{{#unless @last}}, {{/unless}}{{/each}}
                        if you wish to submit them</span>
                    {{/if}}
                </label>
            </li>
            <li>
                <input type="file" name="documents" value="0" id="document0" class="upload-file">
            </li>
        </ul>
    </div>

    <hr>

    <div >
        <h1>Where did it happen?</h1>
        <p class="hint-text">Please be as precise as you are able</p>
        <ul>
            {{#checked where}}
            <li>
                <input type="radio" name="where" id="where-at" value="at"> <label for="where-at">At</label>
                <input type="text" name="at-address" id="at-address" value="{{at-address}}" class="w36">
            </li>
            <li>
                <input type="radio" name="where" id="where-dont-remember" value="dont-remember">
                <label for="where-dont-remember">I don’t exactly remember</label>
            </li>
            <li>
                <input type="radio" name="where" id="where-dont-know" value="dont-know">
                <label for="where-dont-know">I don’t know where it happened</label>
            </li>
            {{/checked}}
        </ul>
    </div>

    <hr>

    <div >
        <h1>Do you know who did it?</h1>
        <p class="hint-text">This could be one person or multiple people or a company or organisation.</p>
        <ul>
            {{#checked who}}
            <li>
                <input type="radio" name="who" id="who-y" value="y">
                <label for="who-y" class="pure-radio greyed-out-unless-checked">Yes</label>
                <br>
                <label for="who-relationship">How do you know them?</label>
                <p class="hint-text">For example, it could be a relative, colleague, or acquaintance.</p>
                <input type="text" name="who-relationship" id="who-relationship" value="{{who-relationship}}" class="w36">
            </li>
            <li>
                <input type="radio" name="who" id="who-n" value="n">
                <label for="who-n" class="pure-radio greyed-out-unless-checked">No</label>
                <p>Please give us a description of the person/people:</p>
                <textarea name="who-description" id="who-description" rows="4" class="pure-input-1">{{who-description}}</textarea>
            </li>
            {{/checked}}
        </ul>
    </div>

    <hr>

    <div >

        <h1>Have you spoken to anybody about it?</h1>

        <p class="hint-text">Pick all options that apply.</p>

        <ul>
            {{#checked action-taken}}
            <li>
                <input type="checkbox" name="action-taken" id="action-taken-police" value="police">
                <label for="action-taken-police">I have told the police</label>
            </li>
            <li>
                <input type="checkbox" name="action-taken" id="action-taken-organisation" value="organisation">
                <label for="action-taken-organisation">I have told somebody within an organisation</label>
            </li>
            <li>
                <input type="checkbox" name="action-taken" id="action-taken-friends" value="friends">
                <label for="action-taken-friends">I spoke to friends or other people I know</label>
            </li>
            <li>
                <input type="checkbox" name="action-taken" id="action-taken-teacher" value="teacher">
                <label for="action-taken-teacher">I spoke to a teacher</label>
            </li>
            <li>
                <input type="checkbox" name="action-taken" id="action-taken-other" value="other">
                <label for="action-taken-other">Other</label>
                <input type="text" name="action-taken-other-details" id="action-taken-other-details" class="w24">
            </li>
            {{/checked}}
        </ul>
    </div>

    <hr>

    <div >
        <h1>Have you used this anonymous reporting service before?</h1>
        <ul>
            {{#checked used-before}}
            <li>
                <input type="radio" name="used-before" id="used-before-y" value="y">
                <label for="used-before-y" class="pure-radio greyed-out-unless-checked">Yes</label>
                <br>
                <label for="existing-name">Enter your anonymous name</label>
                <input type="text" name="existing-name" id="existing-name" value="{{existing-name}}">
                <span id="name-ok" title="name available" class="name-available hide">✓</span>
                <span id="name-nok" title="name not available" class="name-available hide">✗</span>
            </li>
            <li>
                <input type="radio" name="used-before" id="used-before-n" value="n" checked>
                <label for="used-before-n" class="pure-radio greyed-out-unless-checked">No</label>
                <br>
                <p>We make sure that your report is anonymous by creating a random identification name.</p>
                <p>If you want to follow up, use the anonymous name below so we can access any relevant information.</p>
                <div id="usegenerated">
                    <p>This report will use <b><output name="generated-name">{{generated-name}}</output></b>
                        <input type="hidden" name="generated-name" value="{{generated-name}}"></p>
                    <button type="button" id="get-alt-name" class="inline-link">Generate another random name</button>
                </div>
            </li>
            {{/checked}}
        </ul>
        {{> continue}}
    </div>


</form>
